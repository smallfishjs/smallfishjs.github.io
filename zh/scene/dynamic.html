<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>实现一个动态可配置的页面 | smallfish</title>
    <meta name="description" content="一个专注于中台系统的 React 前端解决方案">
    
    
    <link rel="preload" href="/assets/css/0.styles.02904f7e.css" as="style"><link rel="preload" href="/assets/js/app.dbb79151.js" as="script"><link rel="preload" href="/assets/js/3.e17a9923.js" as="script"><link rel="preload" href="/assets/js/27.36c24168.js" as="script"><link rel="prefetch" href="/assets/js/10.a1a462b2.js"><link rel="prefetch" href="/assets/js/11.f5e6ab30.js"><link rel="prefetch" href="/assets/js/12.d6d495ff.js"><link rel="prefetch" href="/assets/js/13.a09db50a.js"><link rel="prefetch" href="/assets/js/14.4a6c6c1d.js"><link rel="prefetch" href="/assets/js/15.3ee11541.js"><link rel="prefetch" href="/assets/js/16.377e61b3.js"><link rel="prefetch" href="/assets/js/17.ad13e981.js"><link rel="prefetch" href="/assets/js/18.ca5fadbe.js"><link rel="prefetch" href="/assets/js/19.74f9ca92.js"><link rel="prefetch" href="/assets/js/20.0c726915.js"><link rel="prefetch" href="/assets/js/21.cec7863f.js"><link rel="prefetch" href="/assets/js/22.d9156cd0.js"><link rel="prefetch" href="/assets/js/23.8d650c59.js"><link rel="prefetch" href="/assets/js/24.b2be5d6e.js"><link rel="prefetch" href="/assets/js/25.c3cdd6c0.js"><link rel="prefetch" href="/assets/js/26.6adb1560.js"><link rel="prefetch" href="/assets/js/28.49a8889e.js"><link rel="prefetch" href="/assets/js/29.e0abad37.js"><link rel="prefetch" href="/assets/js/30.c515804e.js"><link rel="prefetch" href="/assets/js/31.4e003572.js"><link rel="prefetch" href="/assets/js/32.4b2257b9.js"><link rel="prefetch" href="/assets/js/33.abfb0c5e.js"><link rel="prefetch" href="/assets/js/34.aa5152c7.js"><link rel="prefetch" href="/assets/js/35.52bead75.js"><link rel="prefetch" href="/assets/js/36.57b418df.js"><link rel="prefetch" href="/assets/js/37.c170a2db.js"><link rel="prefetch" href="/assets/js/38.5721ac38.js"><link rel="prefetch" href="/assets/js/39.5acf6df4.js"><link rel="prefetch" href="/assets/js/4.f206c44b.js"><link rel="prefetch" href="/assets/js/40.0b5708b1.js"><link rel="prefetch" href="/assets/js/41.0430bb26.js"><link rel="prefetch" href="/assets/js/42.7a6b1c0a.js"><link rel="prefetch" href="/assets/js/5.cbb16fe7.js"><link rel="prefetch" href="/assets/js/6.19619c44.js"><link rel="prefetch" href="/assets/js/7.8f31b0d3.js"><link rel="prefetch" href="/assets/js/8.44f732a4.js"><link rel="prefetch" href="/assets/js/9.b715be2f.js"><link rel="prefetch" href="/assets/js/vendors~docsearch.219b40d1.js">
    <link rel="stylesheet" href="/assets/css/0.styles.02904f7e.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/zh/" class="home-link router-link-active"><!----> <span class="site-name">smallfish</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/zh/start/" class="nav-link">使用 smallfish</a></div><div class="nav-item"><a href="/zh/scene/" class="nav-link router-link-active">场景化方案</a></div><div class="nav-item"><a href="/zh/tool/" class="nav-link">提效工具</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/scene/dynamic.html" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/zh/scene/dynamic.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li></ul></div></div> <a href="https://github.com/smallfishjs/smallfish" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/zh/start/" class="nav-link">使用 smallfish</a></div><div class="nav-item"><a href="/zh/scene/" class="nav-link router-link-active">场景化方案</a></div><div class="nav-item"><a href="/zh/tool/" class="nav-link">提效工具</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">选择语言</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/scene/dynamic.html" class="nav-link">English</a></li><li class="dropdown-item"><!----> <a href="/zh/scene/dynamic.html" class="nav-link router-link-exact-active router-link-active">简体中文</a></li></ul></div></div> <a href="https://github.com/smallfishjs/smallfish" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>场景化方案</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/zh/scene/" class="sidebar-link">什么是场景化解决方案</a></li><li><a href="/zh/scene/mf.html" class="sidebar-link">微应用架构</a></li><li><a href="/zh/scene/antd-form.html" class="sidebar-link">实现一个标准的 antd 查询表单</a></li><li><a href="/zh/scene/form-modal.html" class="sidebar-link">antd Form Modal 的值覆盖问题</a></li><li><a href="/zh/scene/proxy.html" class="sidebar-link">调试线上环境的几种方式</a></li><li><a href="/zh/scene/request.html" class="sidebar-link">更好的处理你的网络请求</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="实现一个动态可配置的页面"><a href="#实现一个动态可配置的页面" aria-hidden="true" class="header-anchor">#</a> 实现一个动态可配置的页面</h1> <p>在 smallfish 中你可以通过开启 <code>dcc</code>(Dynamic Configuration Component) 配置来使用 <code>smallfish/dcc</code> 动态配置组件库。</p> <h2 id="动态配置组件是什么"><a href="#动态配置组件是什么" aria-hidden="true" class="header-anchor">#</a> 动态配置组件是什么</h2> <p><code>dcc</code> 是一种开发模式，通过 Schema 描述局部的页面结构，提供配套的组件数据关联库，实现能够动态配置页面的场景。</p> <p>一个 Schema 是这样的：</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  api<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    getList<span class="token punctuation">:</span> <span class="token string">'/api/list'</span><span class="token punctuation">,</span>
    getUser<span class="token punctuation">:</span> <span class="token string">'/api/user'</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  root<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">'antd-pro-layout'</span><span class="token punctuation">,</span>
    componentName<span class="token punctuation">:</span> <span class="token string">'AntdProLayout'</span><span class="token punctuation">,</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span>
      id<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> <span class="token string">'basic-table'</span><span class="token punctuation">,</span>
        componentName<span class="token punctuation">:</span> <span class="token string">'BasicTable'</span><span class="token punctuation">,</span>
        props<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><p>其实它跟：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">AntdProLayout</span></span> <span class="token attr-name">id</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>id<span class="token punctuation">}</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">BasicTable</span></span> <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">AntdProLayout</span></span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>是一样的，但是因为抽象成了 Schema 能够配合数据动态化，也就是说页面长的样子可以由服务端的数据决定。</p> <h2 id="动态配置组件存在的问题"><a href="#动态配置组件存在的问题" aria-hidden="true" class="header-anchor">#</a> 动态配置组件存在的问题</h2> <p>在页面可配置化的场景下，在需要构建富交互应用时，组件的关联关系和数据映射往往很难处理。</p> <p>通常来讲业界类似的可配置化形态一般都是 SchemaBuilder -&gt; Schema -&gt; SchemaRender，其中处理组件之间的关联关系和数据流转的信息通常是用 Schema 来描述。</p> <p>但是这样的方式使得 Schema 难以维护且配置复杂，这样的原因是因为以前的思路都是按照 UI 组件拆分的维度做组件划分，但是在 <code>smallfish/dcc</code> 中，我们通过业务模块来划分。</p> <p>也就是说我们脱离的 UI 的维度，站在产品业务角度（数据角度）对组件进行划分，分离出业务组件（Business Component）。</p> <p>但是一个业务模块会跟多个业务模块组成一个业务流程，而这个业务流程则是一个闭环，在 <code>smallfish/dcc</code> 中我们以 <code>DataContainer</code> 的概念表示。</p> <p>通常一个系统包含多个业务流程，每个业务流程是相互独立的，但是可能会统一收取系统的信息，在 <code>smallfish/dcc</code> 中最外层就是 <code>GlobalContainer</code>，这一层在调用 <code>RenderComponent</code> 渲染 Schema 的时候会自动加入，不需要使用者手动处理。</p> <h3 id="smallfish-dcc-解决的问题"><a href="#smallfish-dcc-解决的问题" aria-hidden="true" class="header-anchor">#</a> smallfish/dcc 解决的问题</h3> <p>综上所述，所以 <code>smallfish/dcc</code> 提供了一套开发方式以实现 <code>dcc</code> 的开发模式，其中提出的三层组件结构可以解决动态配置中管理组件之间关联关系的问题。</p> <ul><li>GlobalContainer：表示一个业务系统，在数据层面提供 globalData</li> <li>DataContainer：表示一个业务流程，在数据层面提供 storeData</li> <li>BusinessComponent：表示一个业务模块，在数据层面自行管理 state</li></ul> <p>将关联关系从 Schema 下方到各个业务组件，是其核心思想。</p> <h2 id="如何使用-smallfish-dcc"><a href="#如何使用-smallfish-dcc" aria-hidden="true" class="header-anchor">#</a> 如何使用 smallfish/dcc</h2> <h3 id="通过-schema-渲染"><a href="#通过-schema-渲染" aria-hidden="true" class="header-anchor">#</a> 通过 Schema 渲染</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// config/config.js 配置项中启用</span>
<span class="token punctuation">{</span>
  dcc<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre></div><p>在需要使用的地方引入。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">import</span> React <span class="token keyword">from</span> <span class="token string">'smallfish/react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> DataContainer<span class="token punctuation">,</span> RenderComponent <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">'smallfish/dcc'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> schema <span class="token operator">=</span> <span class="token punctuation">{</span>
  api<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    getWife<span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  root<span class="token punctuation">:</span> <span class="token punctuation">{</span>
    id<span class="token punctuation">:</span> <span class="token string">'parent'</span><span class="token punctuation">,</span>
    componentName<span class="token punctuation">:</span> <span class="token string">'Parent'</span><span class="token punctuation">,</span>
    props<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
    children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> <span class="token string">'sun'</span><span class="token punctuation">,</span>
        componentName<span class="token punctuation">:</span> <span class="token string">'Sun'</span><span class="token punctuation">,</span>
        props<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        id<span class="token punctuation">:</span> <span class="token string">'daughter'</span><span class="token punctuation">,</span>
        componentName<span class="token punctuation">:</span> <span class="token string">'Daughter'</span><span class="token punctuation">,</span>
        props<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> Parent <span class="token operator">=</span> <span class="token function">DataContainer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Parent </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  car<span class="token punctuation">:</span> <span class="token string">'GTR'</span><span class="token punctuation">,</span>
  house<span class="token punctuation">:</span> <span class="token string">'Chengdu'</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Parent<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">'Parent'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Sun</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> storeData <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">sun has </span><span class="token punctuation">{</span>storeData<span class="token punctuation">.</span>car<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
Sun<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">'Sun'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Cat</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> name <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">cat's master firstname is </span><span class="token punctuation">{</span>name<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
Cat<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">'Cat'</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token function-variable function">Daughter</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> storeData<span class="token punctuation">,</span> GlobalConsumer <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    daughter has </span><span class="token punctuation">{</span>storeData<span class="token punctuation">.</span>house<span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GlobalConsumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> globalData <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Cat</span></span> <span class="token attr-name">name</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>globalData<span class="token punctuation">.</span>firstname<span class="token punctuation">}</span></span> <span class="token punctuation">/&gt;</span></span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">GlobalConsumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
Daughter<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">'Daughter'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">RenderComponent</span></span>
      <span class="token attr-name">schema</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>schema<span class="token punctuation">}</span></span>
      <span class="token attr-name">components</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>Parent<span class="token punctuation">,</span> Sun<span class="token punctuation">,</span> Daughter<span class="token punctuation">]</span><span class="token punctuation">}</span></span>
      <span class="token attr-name">globalData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        firstname<span class="token punctuation">:</span> <span class="token string">'jack'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="通过-setstoredata-和-storedata-关联组件"><a href="#通过-setstoredata-和-storedata-关联组件" aria-hidden="true" class="header-anchor">#</a> 通过 setStoreData 和 storeData 关联组件</h3> <p>当一个组件被 <code>DataContainer</code> 包裹后，表示一个业务流程，具有向下传递数据的能力，它的子组件可以通过 <code>props.storeData</code> 访问业务流程数据，通过 <code>props.setStoreData</code> 设置业务流程。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> Parent <span class="token operator">=</span> <span class="token function">DataContainer</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">Parent </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  car<span class="token punctuation">:</span> <span class="token string">'GTR'</span><span class="token punctuation">,</span> <span class="token comment">// 初始化的 store: { car: 'GTR' }</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Parent<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">'Parent'</span><span class="token punctuation">;</span>

<span class="token comment">// 子组件可以通过 storeData 获取 { car: 'GTR' }</span>
<span class="token keyword">const</span> <span class="token function-variable function">Sun</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> storeData <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">sun has </span><span class="token punctuation">{</span>storeData<span class="token punctuation">.</span>car<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
Sun<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">'Sun'</span><span class="token punctuation">;</span>

<span class="token comment">// 子组件还可以通过 setStoreData 设置数据</span>
<span class="token keyword">const</span> <span class="token function-variable function">Sun</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> storeData<span class="token punctuation">,</span> setStoreData <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 更新 car 为 BMW，那么父组件和子组件读取的 car 都会变更</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token function">setStoreData</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      car<span class="token punctuation">:</span> <span class="token string">'BMW'</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">sun has </span><span class="token punctuation">{</span>storeData<span class="token punctuation">.</span>car<span class="token punctuation">}</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
Sun<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">'Sun'</span><span class="token punctuation">;</span>
</code></pre></div><p>而这一切关联关系都下放到了组件层，在 Schema 中是没有任何表现的，这也是 <code>smallfish/dcc</code> 的核心思想：让业务组件自行处理上下关联关系，但是要保持独立化就以 <code>storeData</code> 作为输入输出接口。</p> <h3 id="通过-globaldata-和-setglobaldata-处理全局数据"><a href="#通过-globaldata-和-setglobaldata-处理全局数据" aria-hidden="true" class="header-anchor">#</a> 通过 globalData 和 setGlobalData 处理全局数据</h3> <p>一个业务系统可能有多个业务流程，每个业务流程都是一个 <code>DataContainer</code> 包裹的业务组件，而 <code>globalData</code> 就是解决在多个业务流程组件中操作数据的问题。</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">const</span> Parent <span class="token operator">=</span> <span class="token function">DataContainer</span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> children<span class="token punctuation">,</span> GlobalConsumer <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">GlobalConsumer</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
      </span><span class="token punctuation">{</span><span class="token punctuation">(</span><span class="token parameter"><span class="token punctuation">{</span> globalData<span class="token punctuation">,</span> setGlobalData <span class="token punctuation">}</span></span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span></span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
          Parent name: </span><span class="token punctuation">{</span>globalData<span class="token punctuation">.</span>firstname<span class="token punctuation">}</span><span class="token plain-text"> has: </span><span class="token punctuation">{</span>children<span class="token punctuation">}</span><span class="token plain-text">
        </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">GlobalConsumer</span></span><span class="token punctuation">&gt;</span></span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    car<span class="token punctuation">:</span> <span class="token string">'GTR'</span><span class="token punctuation">,</span> <span class="token comment">// 初始化的 globalData: { car: 'GTR' }</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
Parent<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">'Parent'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">RenderComponent</span></span>
      <span class="token attr-name">schema</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>schema<span class="token punctuation">}</span></span>
      <span class="token attr-name">components</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>Parent<span class="token punctuation">,</span> Sun<span class="token punctuation">,</span> Daughter<span class="token punctuation">]</span><span class="token punctuation">}</span></span>
      <span class="token attr-name">globalData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token comment">// 全局数据</span>
        firstname<span class="token punctuation">:</span> <span class="token string">'jack'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="通过-globalconfig-设置全局配置"><a href="#通过-globalconfig-设置全局配置" aria-hidden="true" class="header-anchor">#</a> 通过 globalConfig 设置全局配置</h3> <p>因为 RenderComponent 是根据 Schema 渲染到一个独立的 dom 元素，是局部化的，要配合全局的页面流程需要传入一些通用的配置，比如：api、全局统一处理请求方法等。</p> <p>这些都可以通过 <code>globalConfig</code> 属性实现：</p> <div class="language-jsx extra-class"><pre class="language-jsx"><code><span class="token keyword">export</span> <span class="token keyword">default</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">(</span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span><span class="token punctuation">&gt;</span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">RenderComponent</span></span>
      <span class="token attr-name">schema</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span>schema<span class="token punctuation">}</span></span>
      <span class="token attr-name">components</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">[</span>Parent<span class="token punctuation">,</span> Sun<span class="token punctuation">,</span> Daughter<span class="token punctuation">]</span><span class="token punctuation">}</span></span>
      <span class="token attr-name">globalData</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        <span class="token comment">// 全局数据</span>
        firstname<span class="token punctuation">:</span> <span class="token string">'jack'</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
      <span class="token attr-name">globalConfig</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">{</span><span class="token punctuation">{</span>
        api<span class="token punctuation">:</span> shema<span class="token punctuation">.</span>api<span class="token punctuation">,</span>
        ajax<span class="token punctuation">,</span>
        rootPath<span class="token punctuation">:</span> <span class="token string">'/test'</span><span class="token punctuation">,</span>
        router<span class="token punctuation">,</span> <span class="token comment">// 因为 RenderComponent 是独立的一块，路由需要通过全局传入调用</span>
      <span class="token punctuation">}</span><span class="token punctuation">}</span></span>
    <span class="token punctuation">/&gt;</span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><div class="edit-link"><a href="https://github.com/smallfishjs/smallfish/edit/master/docs/zh/scene/dynamic.md" target="_blank" rel="noopener noreferrer">在 GitHub 上编辑此页</a> <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></div> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">6/11/2019, 3:10:16 PM</span></div></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.dbb79151.js" defer></script><script src="/assets/js/3.e17a9923.js" defer></script><script src="/assets/js/27.36c24168.js" defer></script>
  </body>
</html>
